<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="utf-8">
    <title>Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ø¨Ø²Ø§Ø± Ø¯Ø± Ú¯Ø±Ø¯Ø´</title>
    <style>
        body { font-family: "Tahoma", Arial, sans-serif; direction: rtl; margin: 18px; background:#f4f7fb; }
        .container { max-width:1100px; margin:0 auto; }
        h1 { text-align:center; color:#223; margin-bottom:12px; }
        .card { background:#fff; padding:12px; border-radius:10px; box-shadow:0 3px 10px rgba(0,0,0,0.06); margin-bottom:12px; }
        form.inline { display:flex; flex-wrap:wrap; gap:8px; align-items:center; }
        input[type="text"], select, input[type="file"] { padding:8px; border-radius:8px; border:1px solid #cfd8dc; }
        button.btn { background:#1976d2; color:#fff; border:none; padding:8px 12px; border-radius:10px; cursor:pointer; font-weight:600;
                     box-shadow: 0 4px 8px rgba(25,118,210,0.25); }
        button.btn:active { transform: translateY(1px); box-shadow:0 2px 4px rgba(0,0,0,0.15); }
        table { width:100%; border-collapse:collapse; margin-top:10px; background:#fff; border-radius:8px; overflow:hidden; }
        th, td { padding:8px 10px; border-bottom:1px solid #eef2f6; text-align:center; font-size:14px; }
        thead th { background:#e9f2ff; color:#0b57a4; font-weight:700; }
        tbody tr:hover { background:#fbfdff; }
        .actions { display:flex; gap:6px; justify-content:center; }
        .edit { background:#28a745; padding:6px 9px; color:#fff; border-radius:8px; text-decoration:none; box-shadow:0 3px 6px rgba(40,167,69,0.18); }
        .delete { background:#dc3545; padding:6px 9px; color:#fff; border-radius:8px; text-decoration:none; box-shadow:0 3px 6px rgba(220,53,69,0.18); }
        .small { width:90px; }
        .thread-col { min-width:140px; } /* Ø§ÙØ²Ø§ÛŒØ´ Ø¹Ø±Ø¶ Ø³ØªÙˆÙ† Ø±Ø²ÙˆÙ‡ */
        .desc-cell { text-align:left; max-width:260px; white-space:pre-wrap; word-break:break-word; }
        .search-row { gap:6px; }
        .flash { padding:8px; border-radius:8px; margin-bottom:8px; }
        .flash.success { background:#e6f4ea; color:#155724; }
        .flash.danger { background:#fdecea; color:#721c24; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ›  Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ø¨Ø²Ø§Ø± Ø¯Ø± Ú¯Ø±Ø¯Ø´</h1>

        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for cat, msg in messages %}
                <div class="flash {{ 'success' if cat=='success' else 'danger' }}">{{ msg }}</div>
            {% endfor %}
        {% endif %}
        {% endwith %}

        <!-- Card: Ø¢Ù¾Ù„ÙˆØ¯ Ø§Ú©Ø³Ù„ -->
        <div class="card">
            <form class="inline" method="POST" action="{{ url_for('upload_excel') }}" enctype="multipart/form-data">
                <input type="file" name="excel_file" accept=".xlsx,.xls" required>
                <button class="btn" type="submit">ğŸ“¤ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ÙØ§ÛŒÙ„ Ø§Ú©Ø³Ù„</button>
                <div style="color:#666;font-size:13px;margin-right:8px;">ÙØ±Ù…Øª Ø³ØªÙˆÙ†â€ŒÙ‡Ø§ Ø¨Ù‡â€ŒØµÙˆØ±Øª (Ø§Ù„Ø²Ø§Ù…ÛŒ): <strong>tool_type, serial_number, size, thread_type, location, status</strong> â€” Ø³ØªÙˆÙ† description Ø§Ø®ØªÛŒØ§Ø±ÛŒ</div>
            </form>
        </div>

        <!-- Card: Ø«Ø¨Øª Ø§Ø¨Ø²Ø§Ø± -->
        <div class="card">
            <form class="inline" method="POST" action="{{ url_for('add') }}" enctype="multipart/form-data">
                <input type="text" name="tool_type" placeholder="Ù†ÙˆØ¹ Ø§Ø¨Ø²Ø§Ø± (Ù…Ø«Ù„Ø§Ù‹ HW)" required>
                <select onchange="if(this.value) document.querySelector('[name=tool_type]').value=this.value;">
                    <option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ù†ÙˆØ¹...</option>
                    <option>Drill Pipe</option>
                    <option>HW</option>
                    <option>Drill Collar</option>
                    <option>Cross Over</option>
                    <option>Bit Sub</option>
                    <option>Short Sub</option>
                    <option>Casing Scrapper</option>
                    <option>Uper I-BOP</option>
                    <option>Lower I-BOP</option>
                    <option>Double Box</option>
                    <option>Saver Sub</option>
                    <option>Safty Valve</option>
                    <option>PUP Joint</option>
                    <option>Fishing</option>
                </select>

                <input type="text" name="serial_number" placeholder="Ø´Ù…Ø§Ø±Ù‡ Ø³Ø±ÛŒØ§Ù„" required>
                <input class="small" type="text" name="size" placeholder="Ø³Ø§ÛŒØ²">
                <input class="thread-col" type="text" name="thread_type" placeholder="Ù†ÙˆØ¹ Ø±Ø²ÙˆÙ‡">
                <input type="text" name="location" placeholder="Ù…Ø­Ù„ Ù†Ú¯Ù‡Ø¯Ø§Ø±ÛŒ">

                <select name="status">
                    <option value="Ready to Use">Ready to Use</option>
                    <option value="Need to Repair">Need to Repair</option>
                    <option value="Need to Sandblast">Need to Sandblast</option>
                    <option value="Scrap">Scrap</option>
                    <option value="Class 2">Class 2</option>
                    <option value="Need to Inspection">Need to Inspection</option>
                </select>

                <input type="text" name="description" placeholder="ØªÙˆØ¶ÛŒØ­Ø§Øª (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)" style="min-width:220px;">
                Ú¯Ø²Ø§Ø±Ø´ (PDF): <input type="file" name="report_file" accept=".pdf">
                <button class="btn" type="submit">â• Ø«Ø¨Øª Ø§Ø¨Ø²Ø§Ø±</button>
            </form>
        </div>

        <!-- Card: ÙÛŒÙ„ØªØ± / Ø¬Ø³ØªØ¬Ùˆ -->
        <div class="card">
            <form class="inline search-row" method="GET" action="{{ url_for('index') }}">
                <input type="text" name="tool_type" placeholder="Ù†ÙˆØ¹ Ø§Ø¨Ø²Ø§Ø±" value="{{ tool_type }}">
                <input type="text" name="serial_number" placeholder="Ø´Ù…Ø§Ø±Ù‡ Ø³Ø±ÛŒØ§Ù„" value="{{ serial_number }}">
                <input class="small" type="text" name="size" placeholder="Ø³Ø§ÛŒØ²" value="{{ size }}">
                <input type="text" name="location" placeholder="Ù…Ø­Ù„" value="{{ location }}">
                <select name="status">
                    <option value="">Ù‡Ù…Ù‡ ÙˆØ¶Ø¹ÛŒØªâ€ŒÙ‡Ø§</option>
                    <option value="Ready to Use">Ready to Use</option>
                    <option value="Need to Repair">Need to Repair</option>
                    <option value="Need to Sandblast">Need to Sandblast</option>
                    <option value="Scrap">Scrap</option>
                    <option value="Class 2">Class 2</option>
                    <option value="Need to Inspection">Need to Inspection</option>
                </select>
                <button class="btn" type="submit">ğŸ” Ø¬Ø³ØªØ¬Ùˆ</button>
                <a href="{{ url_for('index') }}"><button type="button" class="btn" style="background:#6c757d;">Ù†Ù…Ø§ÛŒØ´ Ù‡Ù…Ù‡</button></a>
            </form>
        </div>

        <!-- Table -->
        <div class="card" style="padding:6px;">
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Ù†ÙˆØ¹ Ø§Ø¨Ø²Ø§Ø±</th>
                        <th>Ø´Ù…Ø§Ø±Ù‡ Ø³Ø±ÛŒØ§Ù„</th>
                        <th>Ø³Ø§ÛŒØ²</th>
                        <th>Ù†ÙˆØ¹ Ø±Ø²ÙˆÙ‡</th>
                        <th>Ù…Ø­Ù„ Ù†Ú¯Ù‡Ø¯Ø§Ø±ÛŒ</th>
                        <th>ÙˆØ¶Ø¹ÛŒØª</th>
                        <th>Ø¹Ù…Ù„ÛŒØ§Øª</th> <!-- Ø¹Ù…Ù„ÛŒØ§Øª Ù‚Ø¨Ù„ Ø§Ø² Ø´Ø±Ø­ -->
                        <th>Ø´Ø±Ø­</th>
                        <th>Ú¯Ø²Ø§Ø±Ø´</th>
                    </tr>
                </thead>
                <tbody>
                    {% for row in items %}
                    <tr>
                        <td>{{ row['id'] }}</td>
                        <td>{{ row['tool_type'] }}</td>
                        <td>{{ row['serial_number'] }}</td>
                        <td>{{ row['size'] }}</td>
                        <td class="thread-col">{{ row['thread_type'] }}</td>
                        <td>{{ row['location'] }}</td>
                        <td>{{ row['status'] }}</td>
                        <td>
                            <div class="actions">
                                <a class="edit" href="{{ url_for('edit', item_id=row['id']) }}">âœï¸ ÙˆÛŒØ±Ø§ÛŒØ´</a>
                                <form method="POST" action="{{ url_for('delete', item_id=row['id']) }}" style="display:inline;" onsubmit="return confirm('Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ');">
                                    <button type="submit" class="delete">ğŸ—‘ Ø­Ø°Ù</button>
                                </form>
                            </div>
                        </td>
                        <td class="desc-cell">{{ row['description'] or '' }}</td>
                        <td>
                            {% if row['report_link'] %}
                                <a href="{{ row['report_link'] }}" target="_blank">ğŸ“ Ù…Ø´Ø§Ù‡Ø¯Ù‡</a>
                            {% else %} -
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

    </div>
</body>
</html>
