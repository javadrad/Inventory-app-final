<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="utf-8">
    <title>Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ø¨Ø²Ø§Ø± Ø¯Ø± Ú¯Ø±Ø¯Ø´</title>
    <link rel="stylesheet" href="/static/style.css">
    <style>
        /* Ø¬Ø¯ÙˆÙ„ ÙØ´Ø±Ø¯Ù‡â€ŒØªØ± Ùˆ Ø¹Ø±Ø¶ Ø³ØªÙˆÙ†â€ŒÙ‡Ø§ Ø¨Ù‡ØªØ± */
        table { width:100%; border-collapse: collapse; font-family: "Tahoma", sans-serif; }
        th, td { border:1px solid #ddd; padding:6px; text-align:center; font-size:13px; }
        th { background:#f0f3f6; color:#222; }
        tbody tr:nth-child(even){ background:#fbfbfb; }
        tbody tr:hover { background:#eef7ff; }
        /* Ú©Ø§Ù‡Ø´ Ø§Ø±ØªÙØ§Ø¹ Ø±Ø¯ÛŒÙ */
        td, th { line-height:1.1; height:30px; }
        /* Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ */
        .edit-btn { background:#28a745; color:#fff; padding:5px 8px; border-radius:6px; border:none; cursor:pointer; }
        .delete-btn { background:#dc3545; color:#fff; padding:5px 8px; border-radius:6px; border:none; cursor:pointer; margin-left:6px; }
        .btn { background:#007bff; color:#fff; padding:6px 10px; border-radius:8px; border:none; cursor:pointer; }
        input[type="text"], select { padding:6px; border-radius:6px; border:1px solid #ccc; }
        input.description-input { width:98%; padding:4px; font-size:13px; }
        .actions-form { display:inline-block; margin:0; }
        .compact-form { display:inline-block; margin-right:6px; }
        .container { max-width:1100px; margin:18px auto; }
        .card { background:#fff; padding:12px; border-radius:10px; box-shadow:0 2px 6px rgba(0,0,0,0.04); margin-bottom:12px;}
    </style>
</head>
<body>
    <div class="container">
        <h1 style="text-align:center;">ğŸ›  Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ø¨Ø²Ø§Ø± Ø¯Ø± Ú¯Ø±Ø¯Ø´</h1>

        <!-- Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, msg in messages %}
                    <div style="padding:8px;border-radius:6px;margin-bottom:8px; {% if category=='success' %}background:#d4edda;color:#155724;{% elif category=='danger' %}background:#f8d7da;color:#721c24;{% else %}background:#eef2ff;color:#0b4da0;{% endif %}">
                        {{ msg }}
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <!-- Ø«Ø¨Øª Ø§Ø¨Ø²Ø§Ø± -->
        <div class="card">
            <form method="POST" action="/add" enctype="multipart/form-data" style="display:flex;flex-wrap:wrap;gap:8px;align-items:center;">
                <input type="text" name="tool_type" placeholder="Ù†ÙˆØ¹ Ø§Ø¨Ø²Ø§Ø± (Ù…Ø«Ù„Ø§Ù‹ HW)" style="min-width:220px;">
                <select name="tool_type_select" onchange="if(this.value) document.querySelector('[name=tool_type]').value=this.value;">
                    <option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ø§Ø² Ù„ÛŒØ³Øª...</option>
                    <option>Drill Pipe</option>
                    <option>HW</option>
                    <option>Drill Collar</option>
                    <option>Cross Over</option>
                    <option>Bit Sub</option>
                    <option>Short Sub</option>
                    <option>Casing Scrapper</option>
                    <option>Uper I-BOP</option>
                    <option>Lower I-BOP</option>
                    <option>Double Box</option>
                    <option>Saver Sub</option>
                    <option>Safty Valve</option>
                    <option>PUP Joint</option>
                    <option>Fishing</option>
                </select>

                <input type="text" name="serial_number" placeholder="Ø´Ù…Ø§Ø±Ù‡ Ø³Ø±ÛŒØ§Ù„" style="min-width:160px;">
                <input type="text" name="size" placeholder="Ø³Ø§ÛŒØ²" style="width:90px;">
                <input type="text" name="thread_type" placeholder="Ù†ÙˆØ¹ Ø±Ø²ÙˆÙ‡" style="width:140px;">
                <input type="text" name="location" placeholder="Ù…Ø­Ù„ Ù†Ú¯Ù‡Ø¯Ø§Ø±ÛŒ" style="min-width:140px;">

                <select name="status" style="min-width:160px;">
                    <option>Ø¢Ù…Ø§Ø¯Ù‡</option>
                    <option>ØªØ¹Ù…ÛŒØ±</option>
                    <option>Ø³Ù†Ø¯Ø¨Ù„Ø§Ø³Øª</option>
                    <option>Ø®Ø±Ø§Ø¨</option>
                    <option>Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø¨Ø§Ø²Ø±Ø³ÛŒ</option>
                    <option>Class 2</option>
                </select>

                <label style="margin:0;">Ú¯Ø²Ø§Ø±Ø´ (PDF): <input type="file" name="report_file" accept=".pdf" style="margin-left:6px;"></label>

                <input type="text" name="description" placeholder="ØªÙˆØ¶ÛŒØ­Ø§Øª (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)" style="flex:1; min-width:200px;">

                <button type="submit" class="btn">â• Ø«Ø¨Øª Ø§Ø¨Ø²Ø§Ø±</button>
            </form>
        </div>

        <!-- Ø¢Ù¾Ù„ÙˆØ¯ Ø§Ú©Ø³Ù„ (ÙØ±Ù… Ø¬Ø¯Ø§) -->
        <div class="card">
            <form method="POST" action="/upload_excel" enctype="multipart/form-data" style="display:flex;gap:8px;align-items:center;">
                <input type="file" name="excel_file" accept=".xlsx,.xls" required>
                <button type="submit" class="btn">ğŸ“¤ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ</button>
                <div style="color:#666;font-size:13px;margin-left:10px;">ÙØ±Ù…Øª Ø³ØªÙˆÙ†â€ŒÙ‡Ø§ (ØªØ±ØªÛŒØ¨): <strong>tool_type, serial_number, size, thread_type, location, status, description (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)</strong></div>
            </form>
        </div>

        <!-- Ø¬Ø³ØªØ¬Ùˆ -->
        <div class="card" style="display:flex;gap:8px;align-items:center;">
            <form method="GET" action="/" style="display:flex;gap:8px;flex-wrap:wrap;">
                <input type="text" name="tool_type" placeholder="Ù†ÙˆØ¹ Ø§Ø¨Ø²Ø§Ø±" value="{{ tool_type }}">
                <input type="text" name="serial_number" placeholder="Ø´Ù…Ø§Ø±Ù‡ Ø³Ø±ÛŒØ§Ù„" value="{{ serial_number }}">
                <input type="text" name="size" placeholder="Ø³Ø§ÛŒØ²" value="{{ size }}">
                <input type="text" name="location" placeholder="Ù…Ø­Ù„" value="{{ location }}">
                <select name="status">
                    <option value="">Ù‡Ù…Ù‡ ÙˆØ¶Ø¹ÛŒØªâ€ŒÙ‡Ø§</option>
                    <option value="Ø¢Ù…Ø§Ø¯Ù‡">Ø¢Ù…Ø§Ø¯Ù‡</option>
                    <option value="ØªØ¹Ù…ÛŒØ±">ØªØ¹Ù…ÛŒØ±</option>
                    <option value="Ø³Ù†Ø¯Ø¨Ù„Ø§Ø³Øª">Ø³Ù†Ø¯Ø¨Ù„Ø§Ø³Øª</option>
                    <option value="Ø®Ø±Ø§Ø¨">Ø®Ø±Ø§Ø¨</option>
                    <option value="Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø¨Ø§Ø²Ø±Ø³ÛŒ">Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø¨Ø§Ø²Ø±Ø³ÛŒ</option>
                    <option value="Class 2">Class 2</option>
                </select>
                <button type="submit" class="btn">ğŸ” Ø¬Ø³ØªØ¬Ùˆ</button>
                <a href="/" style="text-decoration:none;"><button type="button" class="btn" style="background:#6c757d;">Ù†Ù…Ø§ÛŒØ´ Ù‡Ù…Ù‡</button></a>
            </form>
        </div>

        <!-- Ø¬Ø¯ÙˆÙ„ Ù†Ù…Ø§ÛŒØ´ -->
        <div class="card" style="overflow:auto;">
            <table>
                <thead>
                    <tr>
                        <th style="width:50px;">ID</th>
                        <th style="min-width:130px;">Ù†ÙˆØ¹ Ø§Ø¨Ø²Ø§Ø±</th>
                        <th style="min-width:120px;">Ø´Ù…Ø§Ø±Ù‡ Ø³Ø±ÛŒØ§Ù„</th>
                        <th style="width:70px;">Ø³Ø§ÛŒØ²</th>
                        <th style="min-width:110px;">Ù†ÙˆØ¹ Ø±Ø²ÙˆÙ‡</th>
                        <th style="min-width:120px;">Ù…Ø­Ù„ Ù†Ú¯Ù‡Ø¯Ø§Ø±ÛŒ</th>
                        <th style="min-width:110px;">ÙˆØ¶Ø¹ÛŒØª</th>
                        <th style="width:90px;">Ú¯Ø²Ø§Ø±Ø´</th>
                        <th style="min-width:180px;">ØªÙˆØ¶ÛŒØ­Ø§Øª</th>
                        <th style="width:120px;">Ø¹Ù…Ù„ÛŒØ§Øª</th>
                    </tr>
                </thead>
                <tbody>
                    {% for row in items %}
                    <tr>
                        <td>{{ row['id'] }}</td>
                        <td>{{ row['tool_type'] }}</td>
                        <td>{{ row['serial_number'] }}</td>
                        <td>{{ row['size'] }}</td>
                        <td>{{ row['thread_type'] }}</td>
                        <td>{{ row['location'] }}</td>
                        <td>{{ row['status'] }}</td>
                        <td>
                            {% if row['report_link'] %}
                                <a href="{{ row['report_link'] }}" target="_blank">ğŸ“ Ù…Ø´Ø§Ù‡Ø¯Ù‡</a>
                            {% else %}
                                -
                            {% endif %}
                        </td>
                        <td>{{ row['description'] or "" }}</td>
                        <td>
                            <!-- Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ú©Ù†Ø§Ø± Ù‡Ù…Ø› ÙˆÛŒØ±Ø§ÛŒØ´ GETØŒ Ø­Ø°Ù POST -->
                            <form method="GET" action="/edit/{{ row['id'] }}" class="compact-form">
                                <button type="submit" class="edit-btn">âœï¸ ÙˆÛŒØ±Ø§ÛŒØ´</button>
                            </form>
                            <form method="POST" action="/delete/{{ row['id'] }}" class="compact-form" onsubmit="return confirm('Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ');">
                                <button type="submit" class="delete-btn">ğŸ—‘ Ø­Ø°Ù</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

    </div>
</body>
</html>
